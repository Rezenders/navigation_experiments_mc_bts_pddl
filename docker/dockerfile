FROM ros:foxy

RUN apt update && apt install -y --no-install-recommends\
  git \
  wget \
  build-essential \
  libboost-all-dev \
  python3-pip \
  python3-vcstool \
  python3-rosdep \
  python-is-python3 \
  python3-colcon-common-extensions \
  ros-foxy-urdf \
  ros-foxy-laser-geometry \
  ros-perception \
  ros-foxy-gazebo-ros \
  ros-foxy-gazebo-ros-pkgs \
  ros-foxy-test-msgs \
  ros-foxy-behaviortree-cpp-v3 \
  ros-foxy-map-msgs \
  ros-foxy-rviz-common \
  ros-foxy-rviz-default-plugins \
  ros-foxy-angles \
  ros-foxy-nav2-* \
  ros-foxy-rviz2 \
  ros-foxy-rclcpp-cascade-lifecycle \
  ros-foxy-cascade-lifecycle-msgs \
  && rm -rf /var/lib/apt/lists/

RUN mkdir -p /mros_reasoner_ws/src
WORKDIR /mros_reasoner/src
# RUN git clone https://github.com/Rezenders/navigation_experiments_mc_bts_pddl.git
COPY resources.repos resources.repos
RUN vcs import < resources.repos

COPY navigation_experiments_mc_bts/ navigation_experiments_mc_bts/
COPY navigation_experiments_mc_bts_pddl_base/ navigation_experiments_mc_bts_pddl_base/
COPY navigation_experiments_mc_bts_pddl_log/ navigation_experiments_mc_bts_pddl_log/
COPY navigation_experiments_mc_pddl/ navigation_experiments_mc_pddl/


WORKDIR /mros_reasoner
RUN [ "/bin/bash","-c","source /opt/ros/foxy/setup.bash \
            && apt update && rosdep update \
            && rosdep install -y -r -q --from-paths src --ignore-src --rosdistro foxy --skip-keys='turtlebot2_drivers map_server astra_camera amcl' \
            && rm -rf /var/lib/apt/lists/"]

RUN [ "/bin/bash","-c","source /opt/ros/foxy/setup.bash \
            && colcon build --symlink-install"]

ENV NVIDIA_VISIBLE_DEVICES \
   ${NVIDIA_VISIBLE_DEVICES:-all}
ENV NVIDIA_DRIVER_CAPABILITIES \
   ${NVIDIA_DRIVER_CAPABILITIES:+$NVIDIA_DRIVER_CAPABILITIES,}graphics

ENV GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/mros_reasoner/src/turtlebot3/turtlebot3_simulations/turtlebot3_gazebo/models
ENV TURTLEBOT3_MODEL=${TB3_MODEL}

COPY docker/entrypoint.sh /
ENTRYPOINT ["/entrypoint.sh"]
